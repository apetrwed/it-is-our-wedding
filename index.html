<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Wedding Details | Armenak & Gohar</title>
    <base target="_top">
    <style>
        body {
            font-family: 'Courier Prime', monospace;
            background-color: #f2f0e6;
            color: #303030;
            text-align: center;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        h2 {
            margin-top: 30px;
            font-size: 24px;
        }
        h3 {
            margin-top: 20px;
            font-size: 20px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f7f2;
            border: 1px solid #c9c7bc;
            border-radius: 4px;
        }
        input, select, textarea, button {
            padding: 10px;
            margin: 10px;
            width: 300px;
            font-family: 'Courier Prime', monospace;
            border: 1px solid #c9c7bc;
            border-radius: 4px;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button {
            background-color: #303030;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #505050;
        }
        #response-message {
            margin-top: 10px;
            font-weight: bold;
            min-height: 20px;
        }
        /* Fixed map container style */
        .map-container {
            margin-top: 20px;
            width: 100%;
            height: 300px; /* Fixed height instead of aspect ratio */
            position: relative;
            overflow: hidden;
            border: 1px solid #c9c7bc;
            border-radius: 4px;
        }
        .map-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- RSVP Section -->
        <div class="section rsvp-section">
            <h2>RSVP</h2>
            <p>We hope you can join us for our special day!</p>
            <div>
                <input type="text" id="name" placeholder="Your Name" required>
                <input type="email" id="email" placeholder="Your Email" required>
                <select id="attendance" required>
                    <option value="">Will you attend?</option>
                    <option value="yes">Yes, I'll be there</option>
                    <option value="no">Unfortunately, I cannot attend</option>
                </select>
                <input type="text" id="plusOne" placeholder="Plus One's Name (if applicable)">
                <textarea id="diet" placeholder="Any dietary restrictions or allergies?"></textarea>
                <button onclick="submitRSVP()">Submit RSVP</button>
                <p id="response-message"></p>
            </div>
            <p><strong>Please confirm your attendance by March 19, 2025 at the latest.</strong></p>
        </div>

        <!-- Venue Section -->
        <div class="section venue-section">
            <h2>Ceremony & Reception</h2>
            <p>Casa Cordoba Restaurant</p>
            <p>2331 Honolulu Ave, Montrose, CA 91020</p>
            <p><strong>April 19, 2025 at 6:00 PM</strong></p>
            
            <!-- Fixed map implementation -->
            <div class="map-container" id="map-container">
                <!-- Direct Google Maps embed with API key removed for security -->
                <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3306.744104981726!2d-118.29341692432133!3d34.15174667362662!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x80c2c6e1b0a4c5a1%3A0x5e9a1b4b8f1b4b8f!2sCasa%20Cordoba%20Restaurant!5e0!3m2!1sen!2sus!4v1698765432109!5m2!1sen!2sus" 
                    width="600" 
                    height="450" 
                    style="border:0;" 
                    allowfullscreen="" 
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
        </div>
        
        <!-- Schedule Section -->
        <div class="section schedule-section">
            <h2>Wedding Schedule</h2>
            <div>
                <h3>6:00 PM</h3>
                <p>Arrival & Welcome Drinks</p>
                
                <h3>6:30 PM</h3>
                <p>Ceremony</p>
                
                <h3>7:00 PM</h3>
                <p>Cocktail Hour</p>
                
                <h3>8:00 PM</h3>
                <p>Dinner</p>
                
                <h3>9:00 PM</h3>
                <p>Toasts & Cake Cutting</p>
                
                <h3>9:30 PM - 12:00 AM</h3>
                <p>Dancing & Celebration</p>
            </div>
        </div>
    </div>

    <script>
        // Disable scrolling
        document.addEventListener('wheel', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        document.addEventListener('keydown', function(e) {
            // Prevent arrow keys, space, page up/down from scrolling
            if([32, 33, 34, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
                e.preventDefault();
            }
        }, false);
        
        // Function to calculate and send height to parent
        function sendHeightToParent() {
            const height = document.body.scrollHeight;
            console.log("Sending height update: " + height);
            window.parent.postMessage({ height: height }, "*");
        }
        
        // Listen for height requests from parent
        window.addEventListener("message", function(event) {
            if (event.data && event.data.action === "requestHeight") {
                sendHeightToParent();
            }
        });
        
        // Submit RSVP function
        function submitRSVP() {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const attendance = document.getElementById("attendance").value;
            const plusOne = document.getElementById("plusOne").value;
            const diet = document.getElementById("diet").value;
            const responseMessage = document.getElementById("response-message");
            
            // Basic validation
            if (!name || !email || !attendance) {
                responseMessage.textContent = "Please fill out all required fields.";
                responseMessage.style.color = "red";
                sendHeightToParent();
                return;
            }
            
            // Show processing message
            responseMessage.textContent = "Processing your RSVP...";
            responseMessage.style.color = "black";
            sendHeightToParent();
            
            // Call the Google Apps Script function
            google.script.run
                .withSuccessHandler(function(response) {
                    responseMessage.textContent = response;
                    responseMessage.style.color = "green";
                    // Clear form
                    document.getElementById("name").value = "";
                    document.getElementById("email").value = "";
                    document.getElementById("attendance").value = "";
                    document.getElementById("plusOne").value = "";
                    document.getElementById("diet").value = "";
                    sendHeightToParent();
                })
                .withFailureHandler(function(error) {
                    responseMessage.textContent = "Error submitting form. Please try again later.";
                    responseMessage.style.color = "red";
                    console.error(error);
                    sendHeightToParent();
                })
                .submitRSVP({
                    name: name,
                    email: email,
                    attendance: attendance,
                    plusOne: plusOne,
                    diet: diet
                });
        }
        
        // Send height updates on various events
        window.onload = function() {
            // Wait for map to load
            const mapIframe = document.querySelector('.map-container iframe');
            if (mapIframe) {
                mapIframe.onload = function() {
                    console.log("Map loaded!");
                    sendHeightToParent();
                };
            }
            
            // Delay to ensure all content is rendered
            setTimeout(sendHeightToParent, 100);
            setTimeout(sendHeightToParent, 500);
            setTimeout(sendHeightToParent, 1000);
        };
        
        // Send height when images load
        document.querySelectorAll('img').forEach(img => {
            img.onload = sendHeightToParent;
        });
        
        // Periodically send height updates
        setInterval(sendHeightToParent, 2000);
        
        // Add MutationObserver to detect DOM changes
        const observer = new MutationObserver(function(mutations) {
            sendHeightToParent();
        });
        
        // Start observing the document for DOM changes
        observer.observe(document.body, { 
            childList: true, 
            subtree: true,
            attributes: true,
            characterData: true
        });
    </script>
</body>
</html>
